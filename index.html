<!DOCTYPE html>
<html lang="ar">
<head>
        <meta charset="viewport" content="width=device-width, initial-scale=1.0>
        <meta charset="UTF-8">
        <title>تجربة حفظ البيانات</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
                direction: rtl;
            }
            input, button {
                margin: 10px;
                padding: 8px;
            }
            #dataList {
                margin-top: 20px;
                text-align: right;
            }
        </style>
    </head>
<body>
    <h1>تجربة الاحتفاظ بالبيانات</h1>
    <input type="text" id="userInput" placeholder="ادخل بياناتك هنا">
    <button onclick="saveData()">حفظ</button>
    <button onclick="loadData()">تحميل البيانات</button>
    <div id="dataList"></div>

    <script>
        // رمز الوصول الشخصي (تحذير: غير آمن، للتجربة فقط!)
        const token = 'ghp_wcxLvl0G50GY5J8gv9Brv2cdAsuyOL26q9GP';

        // تحميل البيانات من ملف JSON
        async function loadData() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                const dataList = document.getElementById('dataList');
                dataList.innerHTML = '';
                data.forEach(item => {
                    const p = document.createElement('p');
                    p.textContent = '${item.text} (تم الحفظ في: ${new p.text('${item.textContent} (Date(item.timestamp).toLocaleString('ar')})');
                    dataList.appendChild(p.textContent);
                });
            } catch (error) {
                console.error('خطأ أثناء تحميل البيانات:', error);
            }
        }

        // حفظ البيانات باستخدام GitHub API
        async function saveData() {
            const userInput = document.getElementById('userInput').value;
            if (!userInput) {
                alert('يرجى إدخال البيانات!');
                return;
            }

            try {
                // تحميل المحتوى الحالي لـ data.json
                const repo = 'gity678/static';
                const filePath = 'data.json';
                let sha = null;
                let currentData = [];

                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                        headers: { 'Authorization': `token ${token}` }
                    });
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                    currentData = JSON.parse(atob(fileData.content));
                } catch (e) {
                    // إذا لم يكن الملف موجودًا، سيتم إنشاؤه
                }

                // إضافة البيانات الجديدة
                currentData.push({
                    text: userInput,
                    timestamp: Date.now()
                });

                // تحديث الملف عبر GitHub API
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'تحديث البيانات',
                        content: btoa(JSON.stringify(currentData, null, 2)),
                        sha: sha
                    })
                });

                if (response.ok) {
                    alert('تم حفظ البيانات بنجاح!');
                    document.getElementById('userInput').value = '';
                    loadData();
                } else {
                    alert('فشل في حفظ البيانات!');
                }
            } catch (error) {
                console.error('خطأ أثناء الحفظ:', error);
                alert('حدث خطأ أثناء حفظ البيانات!');
            }
        }

        // تحميل البيانات عند فتح الصفحة
        loadData();
    </script>
</body>
</html>
